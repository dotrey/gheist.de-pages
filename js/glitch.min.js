var glitch=function(g){return g.active=!0,g.intensity=1e-4,g.increase=1e-4,g.indicator=null,g.interval=null,g.infect=function(hasContent){this.updateIndicator(),this.infectLogo(hasContent);for(var p=document.getElementsByTagName("p"),i=0,ic=p.length;i<ic;i++)this.infectText(p[i]);for(var h1=document.getElementsByTagName("h1"),i=0,ic=h1.length;i<ic;i++)this.infectText(h1[i],{rgbThreshold:.75});for(var h2=document.getElementsByTagName("h2"),i=0,ic=h2.length;i<ic;i++)this.infectText(h2[i],{rgbThreshold:.75});for(var h3=document.getElementsByTagName("h3"),i=0,ic=h3.length;i<ic;i++)this.infectText(h3[i],{rgbThreshold:.75})},g.updateIndicator=function(){if(this.indicator||(this.indicator=document.createElement("span"),this.indicator.style.fontFamily="Roboto Mono Regular",this.indicator.style.position="absolute",this.indicator.style.fontSize="0.6em",this.indicator.style.top="1em",this.indicator.style.left="1em",this.indicator.style.lineHeight="0.8",document.body.appendChild(this.indicator),this.interval=window.setInterval(function(){this.intensity+=this.increase,this.intensity>1&&(this.intensity=1,window.clearInterval(this.interval)),this.updateIndicator()}.bind(this),100)),this.intensity<1){for(var v=Math.floor(100*this.intensity),d=Math.floor(1e4*this.intensity)-100*v,p="",tmp=v;tmp>=20;)p+="=",tmp-=20;for(;tmp>=10;)p+="-",tmp-=10;v<10&&(v="0"+v),d<10&&(d="0"+d);var s=v+"."+d;this.indicator.innerHTML=s+"<br/>"+p}else this.indicator.innerHTML="!100!<br/>====="},g.infectText=function(origin,opts){if(void 0===origin.glitch&&origin.offsetParent){opts=opts||{};var glitched=document.createElement(origin.tagName);return glitched.innerHTML=opts.customText||origin.innerHTML,glitched.style.position="absolute",glitched.style.margin=0,glitched.style.display="none",origin.offsetParent.appendChild(glitched),origin.glitch={active:!0,limit:50,loop:-1,delay:5,sleep:500,rgbThreshold:opts.rgbThreshold||1,rgb:[],x:origin.offsetTop,y:origin.offsetLeft,dx:0,dy:0,opacity:.5,clearRgb:function(){if(this.rgb.length){for(var i=0;i<3;i++)this.rgb[i].parentElement&&this.rgb[i].parentElement.removeChild(this.rgb[i]);glitched.innerHTML=opts.customText||origin.innerHTML,glitched.style.color=""}},createRgb:function(){if(!this.rgb.length)for(var color=["rgb(255,0,0)","rgb(0,255,0)","rgb(0,0,255)"],i=0;i<3;i++){var t=document.createElement("span");t.innerHTML=opts.customText||origin.innerHTML,t.style.color=color[i],t.style.display="block",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.opacity=.25,glitched.appendChild(t),this.rgb.push(t)}},randomize:function(){var jitter=10*(1+g.intensity);this.dx=Math.random()*jitter*2-jitter,this.dy=Math.random()*jitter*2-jitter,this.opacity=Math.min(1,Math.max(0,.2+.8*g.intensity*Math.random()))},update:function(){if(glitched.style.top=this.x+this.dx+"px",glitched.style.left=this.y+this.dy+"px",glitched.style.opacity=this.opacity,origin.style.opacity=1-this.opacity,g.intensity<=this.rgbThreshold)this.clearRgb();else{this.createRgb(),this.rgb[0].style.left=.5*this.dx+"px",this.rgb[0].style.top=.5*-this.dy+"px",this.rgb[1].style.left=-this.dx+"px",this.rgb[1].style.top=-this.dy+"px",this.rgb[2].style.left=this.dx+"px",this.rgb[2].style.top=this.dy+"px";for(var i=0;i<3;i++)Math.random()>.5?this.rgb[i].style.display="block":this.rgb[i].style.display="none"}},reset:function(){this.loop=-1,glitched.style.display="none",origin.style.opacity="initial"},disturb:function(){if(g.active&&this.active){if(this.loop<0)return this.reset(),void window.setTimeout(function(){glitched.style.display="block",this.loop=this.limit*g.intensity,this.disturb()}.bind(this),this.sleep/g.intensity+Math.random()*this.sleep/g.intensity);this.randomize(),this.update(),this.loop--,window.setTimeout(function(){this.disturb()}.bind(this),this.delay)}else this.reset()}},origin.addEventListener("click",origin.glitch.disturb.bind(origin.glitch)),origin.glitch.disturb(),origin.glitch}},g.infectLogo=function(hasContent){var gheist=document.querySelector(".logo-gheist"),de=document.querySelector(".logo-de");gheist&&de&&(gheist=gheist.firstElementChild,de=de.firstElementChild,void 0===gheist.glitch?(gheist.glitch={originalString:"gheistde",glitchedString:"glitched",origins:[],setup:function(){gheist.innerHTML="";for(var i=0;i<6;i++){var s;(s=document.createElement("span")).innerHTML=this.originalString[i],gheist.appendChild(s),this.origins[i]=s}de.innerHTML="";for(var i=6;i<8;i++){var s;(s=document.createElement("span")).innerHTML=this.originalString[i],de.appendChild(s),this.origins[i]=s}for(var i=0;i<8;i++)g.infectText(this.origins[i],{customText:this.glitchedString[i],rgbThreshold:.75})},pause:function(){void 0===this.origins[0].glitch&&this.setup();for(var i=0;i<8;i++)void 0!==this.origins[0].glitch&&(this.origins[i].glitch.active=!1)},play:function(){void 0===this.origins[0].glitch&&this.setup();for(var i=0;i<8;i++)void 0!==this.origins[0].glitch&&(this.origins[i].glitch.active=!0,this.origins[i].glitch.disturb())}},gheist.glitch.setup()):hasContent?gheist.glitch.pause():gheist.glitch.play())},"undefined"!=typeof site&&(site.on("content",(function(html){g.infect(!!html)})),site.on("navigate",(function(location){var jump=Math.floor(50*Math.random())/1e3;g.intensity=Math.min(1,g.intensity+jump)}))),g}(glitch||{});console.log("for the glory of mankind");