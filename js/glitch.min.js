var glitch=function(g){return g.active=!0,g.intensity=1e-4,g.increase=1e-4,g.indicator=null,g.interval=null,g.infect=function(hasContent){this.updateIndicator(),this.infectLogo(hasContent),this.infectNav(),this.infectBody();for(var p=document.getElementsByTagName("p"),i=0,ic=p.length;i<ic;i++)this.contentShift(p[i]);for(var h1=document.getElementsByTagName("h1"),i=0,ic=h1.length;i<ic;i++)this.contentShift(h1[i],{rgbThreshold:.75});for(var h2=document.getElementsByTagName("h2"),i=0,ic=h2.length;i<ic;i++)this.contentShift(h2[i],{rgbThreshold:.75});for(var h3=document.getElementsByTagName("h3"),i=0,ic=h3.length;i<ic;i++)this.contentShift(h3[i],{rgbThreshold:.75})},g.updateIndicator=function(){if(this.indicator||(this.indicator=document.createElement("span"),this.indicator.style.fontFamily="Roboto Mono Regular",this.indicator.style.position="absolute",this.indicator.style.fontSize="0.6em",this.indicator.style.top="1em",this.indicator.style.left="1em",this.indicator.style.lineHeight="0.8",document.body.appendChild(this.indicator),this.interval=window.setInterval(function(){this.intensity+=this.increase,this.intensity>.3&&(this.intensity+=this.increase,this.intensity>.6&&(this.intensity+=this.increase)),this.intensity>1&&(this.intensity=1,window.clearInterval(this.interval)),this.updateIndicator()}.bind(this),33)),this.intensity<1){for(var v=Math.floor(100*this.intensity),d=Math.floor(1e4*this.intensity)-100*v,p="",tmp=v;tmp>=20;)p+="=",tmp-=20;for(;tmp>=10;)p+="-",tmp-=10;v<10&&(v="0"+v),d<10&&(d="0"+d);var s=v+"."+d;this.indicator.innerHTML=s+"<br/>"+p}else this.indicator.innerHTML="!100!<br/>====="},g.contentShift=function(origin,opts){if(void 0===origin.glitch&&origin.offsetParent){opts=opts||{};var glitched=document.createElement(origin.tagName);glitched.innerHTML=opts.customText||origin.innerHTML,glitched.style.position="absolute",glitched.style.margin=0,glitched.style.display="none",origin.offsetParent.appendChild(glitched);var glitch=g.createGlitch();return glitch.rgbThreshold=opts.rgbThreshold||1,glitch.rgb=[],glitch.x=origin.offsetTop,glitch.y=origin.offsetLeft,glitch.dx=0,glitch.dy=0,glitch.opacity=.5,glitch.clearRgb=function(){if(this.rgb.length){for(var i=0;i<3;i++)this.rgb[i].parentElement&&this.rgb[i].parentElement.removeChild(this.rgb[i]);glitched.innerHTML=opts.customText||origin.innerHTML,glitched.style.color=""}}.bind(glitch),glitch.createRgb=function(){if(!this.rgb.length)for(var color=["rgb(255,0,0)","rgb(0,255,0)","rgb(0,0,255)"],i=0;i<3;i++){var t=document.createElement("span");t.innerHTML=opts.customText||origin.innerHTML,t.style.color=color[i],t.style.display="block",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.opacity=.25,glitched.appendChild(t),this.rgb.push(t)}}.bind(glitch),glitch.randomize=function(){var jitter=10*(1+g.intensity);this.dx=Math.random()*jitter*2-jitter,this.dy=Math.random()*jitter*2-jitter,this.opacity=Math.min(1,Math.max(0,.2+.8*g.intensity*Math.random()))}.bind(glitch),glitch.update=function(){if(this.randomize(),glitched.style.top=this.x+this.dx+"px",glitched.style.left=this.y+this.dy+"px",glitched.style.opacity=this.opacity,origin.style.opacity=1-this.opacity,g.intensity<=this.rgbThreshold)this.clearRgb();else{this.createRgb(),this.rgb[0].style.left=.5*this.dx+"px",this.rgb[0].style.top=.5*-this.dy+"px",this.rgb[1].style.left=-this.dx+"px",this.rgb[1].style.top=-this.dy+"px",this.rgb[2].style.left=this.dx+"px",this.rgb[2].style.top=this.dy+"px";for(var i=0;i<3;i++)Math.random()>.5?this.rgb[i].style.display="block":this.rgb[i].style.display="none"}}.bind(glitch),glitch.reset=function(){this.loop=-1,glitched.style.display="none",origin.style.opacity="initial"}.bind(glitch),glitch.prepare=function(){glitched.style.display="block",this.loop=this.limit*g.intensity+3}.bind(glitch),origin.glitch=glitch,glitch.disturb(),glitch}},g.contentShuffle=function(origin){if(void 0===origin.glitch&&origin.innerText){var glitch=g.createGlitch();glitch.originalString=origin.innerText,glitch.parts=0,glitch.prepare=function(){this.loop=3,this.delay=100+Math.floor(100*g.intensity)+100*Math.random(),this.parts=Math.min(5,Math.floor(10*g.intensity))}.bind(glitch),glitch.reset=function(){origin.innerHTML=this.originalString,this.loop=-1}.bind(glitch),glitch.update=function(){if(this.parts>1){for(var len=Math.ceil(this.originalString.length/this.parts),tmp=this.originalString,ps=[];tmp.length>=len;)ps.push(tmp.substr(0,len)),tmp=tmp.substr(len);ps.push(tmp);for(var i=ps.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1)),x=ps[i];ps[i]=ps[j],ps[j]=x}origin.innerHTML=ps.join("")}}.bind(glitch),origin.glitch=glitch,glitch.disturb()}},g.infectLogo=function(hasContent){var gheist=document.querySelector(".logo-gheist"),de=document.querySelector(".logo-de"),rotator=document.getElementById("logo-rotator");gheist&&de&&rotator&&(gheist=gheist.firstElementChild,de=de.firstElementChild,void 0===gheist.glitch?(gheist.glitch={originalString:"gheistde",glitchedString:"glitched",origins:[],rotator:[],setup:function(){gheist.innerHTML="";for(var i=0;i<6;i++){var s;(s=document.createElement("span")).innerHTML=this.originalString[i],gheist.appendChild(s),this.origins[i]=s}de.innerHTML="";for(var i=6;i<8;i++){var s;(s=document.createElement("span")).innerHTML=this.originalString[i],de.appendChild(s),this.origins[i]=s}for(var i=0;i<8;i++)g.contentShift(this.origins[i],{customText:this.glitchedString[i],rgbThreshold:.5});this.rotator=rotator.childNodes;for(var i=0,ic=this.rotator.length;i<ic;i++)g.contentShuffle(this.rotator[i])},pause:function(){void 0===this.origins[0].glitch&&this.setup();for(var i=0;i<8;i++)void 0!==this.origins[i].glitch&&(this.origins[i].glitch.active=!1);for(var i=0,ic=this.rotator.length;i<ic;i++)void 0!==this.rotator[i].glitch&&(this.rotator[i].glitch.active=!1)},play:function(){void 0===this.origins[0].glitch&&this.setup();for(var i=0;i<8;i++)void 0!==this.origins[i].glitch&&(this.origins[i].glitch.active=!0,this.origins[i].glitch.disturb());for(var i=0,ic=this.rotator.length;i<ic;i++)void 0!==this.rotator[i].glitch&&(this.rotator[i].glitch.active=!0,this.rotator[i].glitch.disturb())}},gheist.glitch.setup()):hasContent?gheist.glitch.pause():gheist.glitch.play())},g.infectNav=function(){var gh=document.querySelector(".gh.logo-gh");if(gh&&void 0===gh.glitch){for(var nav,a=document.querySelector("nav.links").getElementsByTagName("a"),i=0,ic=a.length;i<ic;i++)this.contentShuffle(a[i]);var dupe=function(top){var isMobile=0===gh.offsetParent.offsetWidth,e=document.createElement("div");e.innerHTML=gh.innerHTML,e.setAttribute("data-group",gh.getAttribute("data-group")),e.setAttribute("class","gh"),e.style.position="absolute",e.style.left=0,top?e.style.top=0:e.style.bottom=0,e.style.width="100%",e.style.height=gh.offsetHeight+"px";var c=document.createElement("div");return c.setAttribute("class",gh.getAttribute("class")),c.style.pointerEvents="none",c.style.overflow="hidden",c.style.position="absolute",c.style.display="none",top?c.style.top=isMobile?"1em":0:isMobile?(c.setAttribute("data-mobile",1),c.style.top=gh.offsetHeight+gh.offsetTop+"px"):c.style.bottom="calc(100% - "+(gh.offsetHeight+gh.offsetTop)+"px)",c.style.right=0,c.style.zIndex=11,c.appendChild(e),gh.offsetParent.appendChild(c),c},injectBlocker=function(top){var b=document.createElement("div");return b.style.width="100%",b.style.position="absolute",top?b.style.top=0:b.style.bottom=0,b.style.left=0,b.style.backgroundColor="inherit",b.style.zIndex=11,gh.appendChild(b),b},glitch=g.createGlitch();glitch.split=[dupe(!0),dupe(!1)],glitch.blocker=[injectBlocker(!0),injectBlocker(!1)],glitch.dx=[0,0],glitch.h=[0,0],glitch.reset=function(){this.loop=-1;for(var i=0;i<2;i++)this.split[i].style.display="none",this.split[i].style.height=0,this.blocker[i].style.display="none",this.blocker[i].style.height=0;this.h=[0,0],this.dx=[0,0]}.bind(glitch),glitch.prepare=function(){this.loop=5,g.intensity>.66?(this.h=[.1+.3*Math.random(),.1+.3*Math.random()],this.dx=[2*(Math.random()-.5),2*(Math.random()-.5)],this.split[0].style.display="block",this.split[1].style.display="block",this.blocker[0].style.display="block",this.blocker[1].style.display="block"):g.intensity>.33&&(this.h=[.1+.8*Math.random(),0],this.dx=[2*(Math.random()-.5),0],this.split[0].style.display="block",this.blocker[0].style.display="block")}.bind(glitch),glitch.update=function(){for(var i=0;i<2;i++){var h=gh.offsetHeight*this.h[i];this.split[i].style.height=h+"px",this.split[i].style.right=this.dx[i]+"em",this.split[i].getAttribute("data-mobile")&&(this.split[i].style.top=gh.offsetHeight+gh.offsetTop-h+"px"),this.blocker[i].style.height=h+"px"}}.bind(glitch),gh.glitch=glitch,glitch.disturb()}},g.infectBody=function(){if(void 0===document.body.glitch){var rgbgrid=document.createElement("div");rgbgrid.style.position="fixed",rgbgrid.style.top=0,rgbgrid.style.left=0,rgbgrid.style.right=0,rgbgrid.style.bottom=0,rgbgrid.style.pointerEvents="none",rgbgrid.style.zIndex=50,rgbgrid.style.background="repeating-linear-gradient(#300, transparent 2.5vh), repeating-linear-gradient(90deg, #030, #003 2.5vh)",rgbgrid.style.opacity=0,rgbgrid.style.transform="scale(6)",rgbgrid.style.transition="opacity 0.2s linear",document.body.appendChild(rgbgrid);var createBar=function(){var bar=document.createElement("div");bar.style.position="fixed",bar.style.width="100%",bar.style.display="none",bar.style.backgroundColor="#000000",bar.style.pointerEvents="none",bar.style.zIndex=99,document.body.appendChild(bar);var y=0,dy=0,height=0,maxHeight=25,glitch=g.createGlitch();return glitch.prepare=function(){if(this.loop=Math.floor(10*g.intensity+g.intensity*g.intensity*10),this.delay=Math.floor(5+g.intensity*g.intensity*10),height=1+Math.random()*g.intensity*25,y=Math.random()*(100-height),bar.style.height=height+"vh",bar.style.display="block",g.intensity>.6){var r=Math.random();r<.25?(bar.style.backgroundColor="#000000",bar.style.mixBlendMode="initial"):r<.5?(bar.style.backgroundColor="#330000",bar.style.mixBlendMode="difference"):r<.75?(bar.style.backgroundColor="#003300",bar.style.mixBlendMode="difference"):(bar.style.backgroundColor="#000033",bar.style.mixBlendMode="difference")}}.bind(glitch),glitch.reset=function(){this.loop=-1,bar.style.display="none",bar.style.backgroundColor="#000000",bar.style.mixBlendMode="initial"}.bind(glitch),glitch.update=function(){var jitter=1+g.intensity;(dy=Math.random()*jitter*2-jitter)+y+height>100&&(dy=100-y-height),bar.style.top=y+"vh",bar.style.opacity=Math.min(1,Math.max(0,.2+.3*g.intensity*Math.random()))}.bind(glitch),glitch.destroy=function(){document.body.removeChild(bar)},bar.glitch=glitch,glitch.disturb(),glitch},bars=[],glitch=g.createGlitch();glitch.prepare=function(){var max=0;for(g.intensity>=.33&&(max=Math.floor(5*g.intensity*Math.random())+5);bars.length>max;){var b;bars.pop().destroy()}for(;bars.length<max;)bars.push(createBar());rgbgrid.style.opacity=Math.max(0,g.intensity-.5)/2}.bind(glitch),glitch.reset=function(){this.loop=-1}.bind(glitch),document.body.glitch=glitch,glitch.disturb()}},g.createGlitch=function(){return{active:!0,limit:25,loop:-1,delay:5,sleep:500,maxSleep:1e4,update:function(){},prepare:function(){},reset:function(){},disturb:function(){if(g.active&&this.active){if(this.loop<0)return this.reset(),void window.setTimeout(function(){this.prepare(),this.disturb()}.bind(this),Math.min(this.maxSleep,this.sleep/g.intensity+Math.random()*this.sleep/g.intensity));this.update(),this.loop--,window.setTimeout(function(){this.disturb()}.bind(this),this.delay)}else this.reset()}}},"undefined"!=typeof site&&(site.on("content",(function(html){g.infect(!!html)})),site.on("navigate",(function(location){var jump=Math.floor(50*Math.random())/1e3;g.intensity=Math.min(1,g.intensity+jump)}))),g}(glitch||{});console.log("for the glory of mankind");