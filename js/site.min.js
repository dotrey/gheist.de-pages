var site=function(my){return my.version="0.3.0",my.debug=!0,my.config={md2htmlWorker:null,rotationInterval:5e3,rotationRandom:!1,lazyImageObserver:null},my.handlers={content:[],navigate:[]},my.onHashChange=function(){this.log(window.location.hash);for(var hash=window.location.hash||"#!/",parts=(hash=hash.substr(1)).split("|"),i=0,ic=parts.length;i<ic;i++)if("!"===parts[i][0])this.navigate(parts[i].substr(1));else if("%"===parts[i][0]){if(void 0===window.glitch){var s=document.createElement("script");s.src="/js/glitch.min.js",document.body.appendChild(s)}this.navigate(parts[i].substr(1))}},my.navigate=function(loc){this.trigger("navigate",loc),loc&&"/"!==loc?("/"===loc[loc.length-1]&&(loc+="readme.md"),this.loadContent(loc)):this.setContent(""),this.menuClose()},my.loadContent=function(loc){this.ajax(loc+this.noCache()).done(function(data){this.displayContent(data)}.bind(this))},my.displayContent=function(md){this.config.md2htmlWorker.postMessage(md)},my.setContent=function(html){var content=this.e("#content"),parent=content.parentElement;parent.removeChild(content),content.innerHTML=html,parent.insertBefore(content,parent.firstChild),document.body.scrollIntoView(!0),this.injectImageLazyLoading(),this.trigger("content",html)},my.injectImageLazyLoading=function(){var images=this.e("#content .img");if(null===this.config.lazyImageObserver&&"undefined"!=typeof IntersectionObserver){var options={root:null,rootMargin:"0px",threshold:0};this.config.lazyImageObserver=new IntersectionObserver(function(entries,observer){entries.forEach((function(entry){entry.isIntersecting&&(entry.target.style.backgroundImage="url('"+entry.target.getAttribute("data-src")+"')",observer.unobserve(entry.target))}))}.bind(this),options)}for(var i=0,ic=images.length;i<ic;i++)this.config.lazyImageObserver?this.config.lazyImageObserver.observe(images[i]):images[i].style.backgroundImage="url('"+images[i].getAttribute("data-src")+"')"},my.enlargeImage=function(element){var l=document.createElement("div");return l.setAttribute("class","large"),l.setAttribute("title",element.getAttribute("title")),l.onclick=function(event){event.stopPropagation(),event.preventDefault(),l.parentNode.removeChild(l)},element.appendChild(l),!1},my.iframeSizeToContent=function(iframe){try{iframe.style.height=5+Math.ceil(iframe.contentDocument.body.parentElement.offsetHeight)+"px"}catch(e){console.log(e)}},my.menuClose=function(){var checkbox=this.e("#checkbox-menu-open");checkbox&&(checkbox.checked=!1)},my.rotate=function(){if(!this.e("#content").innerHTML){for(var container=this.e("#logo-rotator"),current=0,i=0,ic=container.children.length;i<ic;i++)"visible"===container.children[i].getAttribute("class")&&(current=i),container.children[i].setAttribute("class","");var next=(current+1)%ic;if(this.config.rotationRandom)do{next=Math.floor(ic*Math.random())}while(next===current);container.children[next].setAttribute("class","visible")}},my.initialize=function(){this.setupMd2Html(),window.addEventListener("hashchange",this.onHashChange.bind(this),!0),this.log("initialized site v"+this.version),this.onHashChange(),window.setInterval(this.rotate.bind(this),this.config.rotationInterval)},my.setupMd2Html=function(){if(this.log("setup md2html"),window.Worker)this.config.md2htmlWorker=new Worker("/js/md2html-worker.min.js"),this.config.md2htmlWorker.onmessage=function(e){this.setContent(e.data)}.bind(this),this.log(".. worker created");else{this.log(".. worker unavailable, using fallback");var e=document.createElement("script");e.src="/playground/md2html/md2html.js",document.head.appendChild(e),this.config.md2htmlWorker={postMessage:function(md){return"undefined"!=typeof md2html&&(md=md2html.html(md)),md}}}this.on("content",(function(){my.sio("immunoglobulin",void 0,1)||my.e("#content").querySelectorAll("a").forEach((function(a){var href=a.getAttribute("href")||"";0===(href||"").indexOf("#!")&&Math.random()<.01&&(a.setAttribute("href","#%"+href.substr(2)),me.log("<1%"))}))}))},my.ajax=function(url,method,data){method=(method||"get").toUpperCase(),data=data||null;var ajax={ax:null,isDone:!1,isFailed:!1,doneHandlers:[],failHandlers:[],successData:null,failData:null,send:function(){this.ax=new XMLHttpRequest,this.ax.addEventListener("load",function(){200===this.ax.status?this.onDone(this.ax.responseText):this.onFail(this.ax.status)}.bind(this)),data&&(this.ax.setRequestHeader("Content-Type","application/json"),data=JSON.stringify(data)),this.ax.open(method,url,!0),this.ax.send(data)},done:function(callback){return"function"!=typeof callback?this:(this.isDone?callback(this.successData):this.doneHandlers.push(callback),this)},onDone:function(responseData){this.isDone=!0,this.successData=responseData;for(var i=0,ic=this.doneHandlers.length;i<ic;i++)this.doneHandlers[i](responseData)},fail:function(callback){return"function"!=typeof callback?this:(this.isFailed?callback(this.failData):this.failHandlers.push(callback),this)},onFail:function(responseState){this.isFailed=!0,this.failData=responseState;for(var i=0,ic=this.failHandlers.length;i<ic;i++)this.failHandlers[i](responseState)}};return ajax.send(),ajax},my.e=function(selector,parent){if(selector=(""+selector).trim(),parent=parent||document,selector.indexOf(" ")>0){var tmp=selector.split(" ");return parent=this.e(tmp.shift(),parent),this.e(tmp.join(" "),parent)}return"#"===selector.substr(0,1)?parent.getElementById(selector.substr(1)):"."===selector.substr(0,1)?parent.getElementsByClassName(selector.substr(1)):parent.getElementsByTagName(selector)},my.sio=function(key,value,session){try{var s=localStorage;if(session&&(s=sessionStorage),void 0===value)return s.getItem(key);s.setItem(key,value)}catch(e){my.log("exception in storage",e)}return null},my.on=function(event,handler){void 0!==this.handlers[event]&&"function"==typeof handler&&this.handlers[event].push(handler)},my.trigger=function(event,data){for(var i=0,ic=(this.handlers[event]||[]).length;i<ic;i++)this.handlers[event][i](data)},my.noCache=function(){return"?nc="+Date.now()},my.log=function(msg,o){this.debug&&console&&console.log&&(console.log("gh >> "+msg),o&&console.log(o))},my}(site||{});site.initialize();